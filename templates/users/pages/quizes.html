  {% extends "users/base.html" %}

  {% block title %}Exams & Quizzes | Ptr Brightera Academy{% endblock %}

  {% block content %}

  <div class="mt-4 text-center">
    <h1 class="h2 fw-bold">My Exams & Quizzes</h1>
    <p class="text-muted">
      Complete your course to unlock quizzes and exams
    </p>
  </div>

  <div class="row mt-5">

    <!-- QUIZZES SECTION -->
    <div class="col-lg-6 mb-4">
      <h3 class="h5 fw-bold mb-3 border-bottom pb-2">
        Quizzes
      </h3>

      <div class="row justify-content-center">
        {% for course in courses %}
          <div class="col-md-10 col-lg-9 mb-3">
            <div class="card shadow-sm">

              <div class="card-body p-3">
                <h6 class="fw-bold mb-2">{{ course.title }}</h6>

                <p class="text-muted small mb-3">
                  Progress: {{ course.progress }}%
                </p>

                {% if course.quiz_id %}
                  {% if course.progress == 100 %}

                    {% if course.best_percentage == 100 %}
                      <button class="btn btn-outline-success btn-sm w-100" disabled>
                        Quiz Passed
                      </button>
                    {% else %}
                      <a href="{{ url_for('start_quiz', course_slug=course.slug) }}"
                         class="btn btn-success btn-sm w-100">
                        Take Quiz
                      </a>
                    {% endif %}

                  {% else %}
                    <button class="btn btn-secondary btn-sm w-100" disabled>
                      Quiz Locked
                    </button>
                  {% endif %}
                {% else %}
                  <button class="btn btn-outline-secondary btn-sm w-100" disabled>
                    No Quiz Available
                  </button>
                {% endif %}

              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- EXAMS SECTION -->
      <div class="col-lg-6 mb-4">
        <h3 class="h5 fw-bold mb-3 border-bottom pb-2">
          <i class="fas fa-file-alt"></i> Exams
        </h3>
  
        {% if exams %}
          {% for exam in exams %}
            <div class="card mb-3 shadow-sm {% if exam.is_disqualified == 1 %}border-danger disqualified-exam{% endif %}">
              <div class="card-body p-3">
  
                <!-- Exam Title with Disqualified Badge -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="fw-bold mb-0 {% if exam.is_disqualified == 1 %}text-danger{% else %}text-primary{% endif %}">
                    {{ exam.title }}
                  </h6>
                  {% if exam.is_disqualified == 1 %}
                    <span class="badge bg-danger">
                      <i class="fas fa-ban"></i> Disqualified
                    </span>
                  {% elif exam.attempt_status == 'in_progress' %}
                    <span class="badge bg-warning">
                      <i class="fas fa-spinner fa-spin"></i> In Progress
                    </span>
                  {% elif exam.attempt_status == 'submitted' %}
                    <span class="badge bg-info">
                      <i class="fas fa-hourglass-half"></i> Submitted
                    </span>
                  {% elif exam.attempt_status == 'graded' %}
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle"></i> Graded
                    </span>
                  {% endif %}
                </div>
  
                <p class="text-muted small mb-3">
                  <i class="fas fa-clock"></i> {{ exam.duration_minutes }} mins | 
                  <i class="fas fa-star"></i> {{ exam.total_marks }} marks 
                </p>
  
                <!-- DISQUALIFIED EXAM - Show disabled button -->
                {% if exam.is_disqualified == 1 %}
                  <div class="alert alert-danger py-2 mb-0 small">
                    <i class="fas fa-exclamation-triangle"></i> 
                    This exam attempt has been disqualified.
                    <button class="btn btn-danger btn-sm w-100 mt-2" disabled>
                      <i class="fas fa-ban"></i> Exam Disqualified
                    </button>
                  </div>
  
                <!-- EXAM IN PROGRESS -->
                {% elif exam.attempt_status == 'in_progress' %}
                  <div class="alert alert-warning py-2 mb-0 small">
                    <i class="fas fa-spinner fa-spin"></i> 
                    Exam in progress
                    <a href="{{ url_for('exam_question', exam_slug=exam.slug) }}" 
                       class="btn btn-warning btn-sm w-100 mt-2">
                       <i class="fas fa-play-circle"></i> Continue Exam
                    </a>
                  </div>
  
                <!-- EXAM SUBMITTED (awaiting grading) -->
                {% elif exam.attempt_status == 'submitted' %}
                  <div class="alert alert-info py-2 mb-0 small">
                    <i class="fas fa-check-circle"></i> 
                    Exam submitted
                    <button class="btn btn-outline-info btn-sm w-100 mt-2" disabled>
                      <i class="fas fa-hourglass-half"></i> Awaiting Results
                    </button>
                  </div>
  
                <!-- EXAM GRADED (results available) -->
                {% elif exam.attempt_status == 'graded' %}
                  <div class="alert alert-success py-2 mb-0 small">
                    <i class="fas fa-award"></i> 
                    Results published
                    <a href="{{ url_for('exam_results', exam_slug=exam.slug) }}" 
                       class="btn btn-success btn-sm w-100 mt-2">
                       <i class="fas fa-chart-line"></i> View Results
                    </a>
                  </div>
  
                <!-- EXAM AVAILABLE (not started) -->
                {% elif exam.unlocked == 1 %}
                  <a href="{{ url_for('start_exam', exam_slug=exam.slug) }}"
                     class="btn btn-primary btn-sm w-100">
                     <i class="fas fa-play"></i> Start Exam
                  </a>
  
                <!-- EXAM LOCKED (course not completed) -->
                {% else %}
                  <div class="alert alert-secondary py-2 mb-0 small">
                    <i class="fas fa-lock"></i> 
                    Complete course lessons to unlock
                    <button class="btn btn-secondary btn-sm w-100 mt-2" disabled>
                      <i class="fas fa-lock"></i> Exam Locked
                    </button>
                  </div>
                {% endif %}
  
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="alert alert-light text-center py-4">
            <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
            <h6 class="text-muted">No exams available</h6>
            <p class="small text-muted mb-0">Complete your course lessons to unlock exams.</p>
          </div>
        {% endif %}
      </div>

  </div>

  {% endblock %}
