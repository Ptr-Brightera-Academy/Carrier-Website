{% extends "users/base.html" %}

{% block title %}Settings | Ptr Brightera Academy{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 mb-0">âš™ï¸ Account Settings</h1>

    <!-- Flash Messages -->
    <div style="min-width: 250px;">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show py-2 px-3 mb-2
                        {% if category in ['danger', 'warning'] %}auto-hide{% endif %}" 
                 role="alert">
              {{ message }}
              <button type="button" class="btn-close btn-sm" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

  </div>

  

  <div class="row">

    <!-- LEFT MENU -->
    <div class="col-md-3 mb-4">
      <div class="list-group shadow-sm">
        <a href="#security" class="list-group-item list-group-item-action active">ğŸ” Account & Security</a>
        <a href="#support" class="list-group-item list-group-item-action">ğŸ†˜ Support</a>
      </div>
    </div>

    <!-- RIGHT CONTENT -->
    <div class="col-md-9">

      <!-- ACCOUNT & SECURITY -->
      <div id="security" class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Account & Security</h5>

          <div class="list-group list-group-flush">

            <a href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              Change Password <span>ğŸ”‘</span>
            </a>

            <a href="#" data-bs-toggle="modal" data-bs-target="#loginActivityModal"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              Login Activity <span>ğŸ–¥ï¸</span>
            </a>

            <a href="#" data-bs-toggle="modal" data-bs-target="#logoutAllModal"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              Logout from All Devices <span>ğŸšª</span>
            </a>

            <a href="#" data-bs-toggle="modal" data-bs-target="#deleteAccountModal"
               class="list-group-item list-group-item-action text-danger d-flex justify-content-between align-items-center">
              Delete Account <span>ğŸ—‘ï¸</span>
            </a>

          </div>
        </div>
      </div>

      <!-- SUPPORT -->
      <div id="support" class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Support</h5>

          <div class="list-group list-group-flush">

            <a href="#" data-bs-toggle="modal" data-bs-target="#contactSupportModal"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              Contact Support <span>ğŸ“©</span>
            </a>

            <a href="#" data-bs-toggle="modal" data-bs-target="#reportProblemModal"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              Report a Problem <span>ğŸ</span>
            </a>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ===================== MODALS ===================== -->

<!-- Change Password -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('change_password') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="password" name="current_password" class="form-control mb-3" placeholder="Current Password" required>
        <input type="password" name="new_password" class="form-control mb-3" placeholder="New Password" required>
        <input type="password" name="confirm_password" class="form-control" placeholder="Confirm New Password" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary w-100">Update Password</button>
      </div>
    </form>
  </div>
</div>

<!-- Login Activity -->
<div class="modal fade" id="loginActivityModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Login Activity</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted">Recent sessions will appear here.</p>
      </div>
    </div>
  </div>
</div>

<!-- Logout All Devices -->
<div class="modal fade" id="logoutAllModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('logout_all_sessions') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Logout Everywhere</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        This will log you out from all devices.
      </div>
      <div class="modal-footer">
        <button class="btn btn-warning w-100">Confirm Logout</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Account -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('delete_account') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-danger">Delete Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-danger"><strong>This cannot be undone.</strong></p>
        <input type="text" name="confirm_text" class="form-control" placeholder="Type DELETE to confirm" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger w-100">Delete My Account</button>
      </div>
    </form>
  </div>
</div>

<!-- Contact Support -->
<div class="modal fade" id="contactSupportModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('contact_support') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Contact Support</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea name="message" class="form-control" rows="4" placeholder="How can we help you?" required></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary w-100">Send Message</button>
      </div>
    </form>
  </div>
</div>

<!-- Report Problem -->
<div class="modal fade" id="reportProblemModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('report_problem') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Report a Problem</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="text" name="subject" class="form-control mb-3" placeholder="Problem title" required>
        <textarea name="description" class="form-control" rows="4" placeholder="Describe the issue..." required></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger w-100">Submit Report</button>
      </div>
    </form>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const container = document.querySelector('[style*="min-width: 250px"]');
  if (!container) return;

  const alerts = container.querySelectorAll('.alert');

  if (alerts.length > 0) {
    setTimeout(() => {
      alerts.forEach(alert => {
        alert.style.transition = "opacity 0.5s ease, max-height 0.5s ease";
        alert.style.opacity = "0";
        alert.style.maxHeight = "0";
        alert.style.padding = "0";
        alert.style.margin = "0";

        setTimeout(() => alert.remove(), 500);
      });
    }, 4000);
  }
});
</script>


{% endblock %}
