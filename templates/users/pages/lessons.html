{% extends "users/base.html" %}

{% block title %}{{ lesson.title }} | {{ course.title }}{% endblock %}

{% block content %}

<div class="row">

  <!-- LESSON SIDEBAR -->
  <div class="col-md-3 border-end d-none d-md-block">
    <h6 class="mt-3 fw-bold">{{ course.title }}</h6>

    <ul class="list-group mt-3">
      {% for l in lessons %}
        <a href="{{ url_for('lesson_page',
            course_slug=course.slug,
            lesson_slug=l.slug) }}"
           class="list-group-item {% if l.id == lesson.id %}active{% endif %}">
          {{ l.title }}
        </a>
      {% endfor %}
    </ul>
  </div>

  <!-- LESSON CONTENT -->
  <div class="col-md-9">
  
    <div class="card shadow-sm">
      <div class="card-body">
        {{ lesson.content | safe }}
      </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between mt-4">
      {% if prev_lesson %}
        <a class="btn btn-outline-primary"
           href="{{ url_for('lesson_page',
               course_slug=course.slug,
               lesson_slug=prev_lesson.slug) }}">
          ← Previous
        </a>
      {% else %}
        <span></span>
      {% endif %}

      {% if next_lesson %}
        <a class="btn btn-primary"
           href="{{ url_for('lesson_page',
               course_slug=course.slug,
               lesson_slug=next_lesson.slug) }}">
          Next →
        </a>
      {% endif %}
    </div>

  </div>

</div>
<script>
  let lessonCompleted = false;

  setTimeout(() => {
    fetch("{{ url_for('complete_lesson') }}", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        lesson_id: {{ lesson.id }},
        course_id: {{ course.id }}
      })
    })
    .then(res => res.json())
    .then(data => {
      lessonCompleted = true;
      console.log("Lesson marked complete");
    });
  }, 100); // 2 minutes
</script>

{% endblock %}



